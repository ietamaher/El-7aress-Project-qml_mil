<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RCWS Telemetry Dashboard</title>
    <link rel="stylesheet" href="css/dashboard.css">

    <!-- Chart.js for visualizations (CDN) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="dashboard-header">
        <div class="header-left">
            <h1>üéØ RCWS Telemetry Dashboard</h1>
            <span class="system-version">Qt6 Military System v1.0</span>
        </div>
        <div class="header-right">
            <div class="connection-status" id="connectionStatus">
                <span class="status-indicator offline"></span>
                <span class="status-text">Disconnected</span>
            </div>
            <div class="auth-info" id="authInfo">
                <span class="username">Not logged in</span>
                <button class="btn-logout" id="logoutBtn" style="display: none;">Logout</button>
            </div>
        </div>
    </header>

    <!-- Login Modal -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <h2>Authentication Required</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="serverUrl">Server URL:</label>
                    <input type="text" id="serverUrl" value="http://localhost:8443" required>
                </div>
                <div class="form-group">
                    <label for="username">Username:</label>
                    <input type="text" id="username" value="admin" required>
                </div>
                <div class="form-group">
                    <label for="password">Password:</label>
                    <input type="password" id="password" value="admin123" required>
                </div>
                <div class="form-error" id="loginError"></div>
                <button type="submit" class="btn-primary">Login</button>
            </form>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div class="dashboard-container">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <ul class="nav-menu">
                <li class="nav-item active" data-view="live">
                    <span class="nav-icon">üìä</span>
                    <span class="nav-label">Live Telemetry</span>
                </li>
                <li class="nav-item" data-view="historical">
                    <span class="nav-icon">üìà</span>
                    <span class="nav-label">Historical Data</span>
                </li>
                <li class="nav-item" data-view="system">
                    <span class="nav-icon">‚öôÔ∏è</span>
                    <span class="nav-label">System Status</span>
                </li>
            </ul>
        </nav>

        <!-- Content Area -->
        <main class="content-area">
            <!-- Live Telemetry View -->
            <div class="view-panel active" id="liveView">
                <h2 class="panel-title">Real-Time Telemetry (10 Hz)</h2>

                <!-- Gimbal Status -->
                <section class="telemetry-section">
                    <h3>Gimbal Position & Motion</h3>
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-label">Azimuth</div>
                            <div class="metric-value" id="gimbalAz">---</div>
                            <div class="metric-unit">degrees</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Elevation</div>
                            <div class="metric-value" id="gimbalEl">---</div>
                            <div class="metric-unit">degrees</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Az Speed</div>
                            <div class="metric-value" id="azSpeed">---</div>
                            <div class="metric-unit">deg/s</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">El Speed</div>
                            <div class="metric-value" id="elSpeed">---</div>
                            <div class="metric-unit">deg/s</div>
                        </div>
                    </div>
                </section>

                <!-- IMU Data -->
                <section class="telemetry-section">
                    <h3>IMU Orientation</h3>
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-label">Roll</div>
                            <div class="metric-value" id="imuRoll">---</div>
                            <div class="metric-unit">degrees</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Pitch</div>
                            <div class="metric-value" id="imuPitch">---</div>
                            <div class="metric-unit">degrees</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Yaw</div>
                            <div class="metric-value" id="imuYaw">---</div>
                            <div class="metric-unit">degrees</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Temperature</div>
                            <div class="metric-value" id="imuTemp">---</div>
                            <div class="metric-unit">¬∞C</div>
                        </div>
                    </div>
                </section>

                <!-- Motor Temperatures -->
                <section class="telemetry-section">
                    <h3>Motor Temperatures</h3>
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-label">Az Motor</div>
                            <div class="metric-value" id="azMotorTemp">---</div>
                            <div class="metric-unit">¬∞C</div>
                            <div class="temp-bar">
                                <div class="temp-fill" id="azMotorTempBar"></div>
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Az Driver</div>
                            <div class="metric-value" id="azDriverTemp">---</div>
                            <div class="metric-unit">¬∞C</div>
                            <div class="temp-bar">
                                <div class="temp-fill" id="azDriverTempBar"></div>
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">El Motor</div>
                            <div class="metric-value" id="elMotorTemp">---</div>
                            <div class="metric-unit">¬∞C</div>
                            <div class="temp-bar">
                                <div class="temp-fill" id="elMotorTempBar"></div>
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">El Driver</div>
                            <div class="metric-value" id="elDriverTemp">---</div>
                            <div class="metric-unit">¬∞C</div>
                            <div class="temp-bar">
                                <div class="temp-fill" id="elDriverTempBar"></div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Weapon & Tracking Status -->
                <section class="telemetry-section">
                    <h3>Weapon & Tracking Status</h3>
                    <div class="status-grid">
                        <div class="status-indicator" id="gunArmed">
                            <span class="indicator-light"></span>
                            <span class="indicator-label">Gun Armed</span>
                        </div>
                        <div class="status-indicator" id="ammoLoaded">
                            <span class="indicator-light"></span>
                            <span class="indicator-label">Ammo Loaded</span>
                        </div>
                        <div class="status-indicator" id="trackingActive">
                            <span class="indicator-light"></span>
                            <span class="indicator-label">Tracking Active</span>
                        </div>
                        <div class="status-indicator" id="validTarget">
                            <span class="indicator-light"></span>
                            <span class="indicator-label">Valid Target</span>
                        </div>
                    </div>
                </section>

                <!-- Live Chart -->
                <section class="telemetry-section">
                    <h3>Gimbal Position History (Last 30 seconds)</h3>
                    <div class="chart-container">
                        <canvas id="liveChart"></canvas>
                    </div>
                </section>
            </div>

            <!-- Historical Data View -->
            <div class="view-panel" id="historicalView">
                <h2 class="panel-title">Historical Data Analysis</h2>

                <div class="controls-section">
                    <div class="form-group inline">
                        <label for="dataCategory">Data Category:</label>
                        <select id="dataCategory">
                            <option value="gimbal">Gimbal Motion</option>
                            <option value="imu">IMU Data</option>
                            <option value="device">Device Status</option>
                            <option value="tracking">Tracking Data</option>
                            <option value="weapon">Weapon Status</option>
                        </select>
                    </div>
                    <div class="form-group inline">
                        <label for="timeRange">Time Range:</label>
                        <select id="timeRange">
                            <option value="1">Last 1 hour</option>
                            <option value="6">Last 6 hours</option>
                            <option value="24">Last 24 hours</option>
                            <option value="168">Last 7 days</option>
                        </select>
                    </div>
                    <button class="btn-primary" id="loadHistoricalBtn">Load Data</button>
                    <button class="btn-secondary" id="exportCsvBtn">Export CSV</button>
                </div>

                <div class="chart-container large">
                    <canvas id="historicalChart"></canvas>
                </div>

                <div class="statistics-panel">
                    <h3>Statistics</h3>
                    <div class="stats-grid" id="statsGrid">
                        <div class="stat-item">
                            <span class="stat-label">Samples:</span>
                            <span class="stat-value" id="statSamples">---</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Min Value:</span>
                            <span class="stat-value" id="statMin">---</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Max Value:</span>
                            <span class="stat-value" id="statMax">---</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Average:</span>
                            <span class="stat-value" id="statAvg">---</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- System Status View -->
            <div class="view-panel" id="systemView">
                <h2 class="panel-title">System Status</h2>

                <section class="telemetry-section">
                    <h3>Connection Information</h3>
                    <div class="info-table">
                        <div class="info-row">
                            <span class="info-label">Server URL:</span>
                            <span class="info-value" id="infoServerUrl">---</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">WebSocket URL:</span>
                            <span class="info-value" id="infoWsUrl">---</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Username:</span>
                            <span class="info-value" id="infoUsername">---</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">User Role:</span>
                            <span class="info-value" id="infoRole">---</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Connection State:</span>
                            <span class="info-value" id="infoConnectionState">---</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Messages Received:</span>
                            <span class="info-value" id="infoMessagesReceived">0</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Update Rate:</span>
                            <span class="info-value" id="infoUpdateRate">--- Hz</span>
                        </div>
                    </div>
                </section>

                <section class="telemetry-section">
                    <h3>Available Endpoints</h3>
                    <div class="endpoints-list">
                        <div class="endpoint-item">
                            <span class="endpoint-method">POST</span>
                            <span class="endpoint-path">/api/auth/login</span>
                        </div>
                        <div class="endpoint-item">
                            <span class="endpoint-method">GET</span>
                            <span class="endpoint-path">/api/telemetry/current</span>
                        </div>
                        <div class="endpoint-item">
                            <span class="endpoint-method">GET</span>
                            <span class="endpoint-path">/api/telemetry/gimbal/history</span>
                        </div>
                        <div class="endpoint-item">
                            <span class="endpoint-method">GET</span>
                            <span class="endpoint-path">/api/telemetry/imu/history</span>
                        </div>
                        <div class="endpoint-item">
                            <span class="endpoint-method">GET</span>
                            <span class="endpoint-path">/api/export/csv</span>
                        </div>
                        <div class="endpoint-item">
                            <span class="endpoint-method">WS</span>
                            <span class="endpoint-path">ws://localhost:8444/telemetry</span>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- JavaScript -->
    <script src="js/telemetry-client.js"></script>
    <script src="js/charts.js"></script>
    <script src="js/dashboard.js"></script>
</body>
</html>
